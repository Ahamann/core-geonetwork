<div class="row" 
    data-ng-controller="GnUserGroupController">
    <div class="col-lg-4">
        <div class="panel">
            <div class="panel-heading"
                data-translate>users</div>
            
            <input data-ng-model="userSearch.$" placeholder="{{'filter' | translate}}"/>
            <input type="hidden" data-ng-model="userSelected.id"/>
            <div class="list-group">
                <a class="list-group-item" 
                    data-ng-repeat="u in users | filter:userSearch | orderBy:'name'"  
                    data-ng-click="selectUser(u)">
                    {{u.name}} {{u.surname}}
                </a>
            </div>
            
            <button type="button" class="btn btn-primary icon-plus" 
                data-ng-click="addUser()" 
                data-translate>newUser</button>
        </div>
    </div>
    
    <div class="col-lg-8" 
        data-ng-hide="userSelected.id == null">
        <div class="panel">
            <div class="panel-heading"
                title="{{userHasRecords() ? ('cantDeleteUserHavingRecords' | translate) : ''}}">
                <span data-ng-hide="userSelected.id == ''" data-translate>updateUser</span>
                <span data-ng-hide="userSelected.id != ''" data-translate>newUser</span>
                <span>{{userSelected.name}} {{userSelected.surname}}</span>
                <button type="button" class="btn btn-primary pull-right icon-save" 
                    data-ng-disabled="!userUpdated"
                    data-ng-click="saveUser('#gn-user-edit')" 
                    data-translate>saveUser</button>
                <button type="button" class="btn btn-primary pull-right btn-danger icon-remove" 
                    data-ng-disabled="userHasRecords()"
                    data-ng-hide="userSelected.id == ''"
                    data-ng-click="deleteUser(userSelected.id)" 
                    data-translate>deleteUser</button>
            </div>
            
            
            
            <form id="gn-user-edit" 
                data-ng-keypress="updatingUser()">
                <fieldset>
                    <input type="hidden" name="id" 
                        data-ng-model="userSelected.id" value="{{userSelected.id}}"></input>
                    <input type="hidden" name="operation" 
                        data-ng-model="userOperation" value="{{userOperation}}"></input>
                    
                    <label data-translate>username</label>
                    <input type="text" name="username" 
                        data-ng-model="userSelected.username"></input>
                    <p class="help-block" data-translate>usernameHelp</p>
                    
                    <!-- Password are disabled when updating user -->
                    <div ng-hide="userOperation != 'newuser'">
                        <label data-translate>password</label>
                        <input type="password" id="gn-user-password" name="password"
                            data-ng-model="userSelected.password"></input>
                        
                        <label data-translate>passwordRepeat</label>
                        <input type="password" id="gn-user-password2" name="password2"
                            ></input>
                    </div>
                    
                    <div ng-class="userSelected.name == '' ? 'has-error' : ''">
                        <label class="control-label" data-translate>name</label>
                        <input type="text" name="name" 
                            data-ng-model="userSelected.name"></input>
                    </div>
                    
                    <div ng-class="userSelected.surname == '' ? 'has-error' : ''">
                        <label class="control-label" data-translate>username</label>
                        <input type="text" name="surname" 
                            data-ng-model="userSelected.surname"></input>
                    </div>
                    
                    
                    <div ng-class="userSelected.email == '' ? 'has-error' : ''">
                        <label class="control-label" data-translate>email</label>
                        <input type="email" name="email"
                            data-ng-model="userSelected.email"></input>
                    </div>
                    
                    
                    <label data-translate>organisation</label>
                    <!-- TODO : Add org list -->
                    <input type="text" name="org" 
                        data-ng-model="userSelected.organisation"></input>
                    
                    <fieldset>
                        <legend data-translate>address</legend>
                        
                        <label data-translate>address</label>
                        <input type="text" name="address" 
                            data-ng-model="userSelected.address"></input>
                        <label data-translate>zip</label>
                        <input type="text" name="zip" 
                            data-ng-model="userSelected.zip"></input>
                        <label data-translate>state</label>
                        <input type="text" name="state" 
                            data-ng-model="userSelected.state"></input>
                        <label data-translate>city</label>
                        <input type="text" name="city" 
                            data-ng-model="userSelected.city"></input>
                        <label data-translate>country</label>
                        <!-- TODO : Add country list -->
                        <input type="text" name="country" 
                            data-ng-model="userSelected.country"></input>
                    </fieldset>
                    
                    <fieldset>
                        <legend data-translate>defineUserGroupsPerProfile</legend>
                        
                        <input type="hidden" name="profile" 
                            data-ng-model="userSelected.profile"
                            value="{{userSelected.profile}}"></input>
                        
                        <label>
                            <input type="checkbox" 
                                data-ng-model="userIsAdmin"
                                data-ng-click="setUserProfile(true)"
                            />
                            <span>isAdministrator</span>
                        </label>
                        <div data-ng-hide="userIsAdmin">
                            <h3 data-translate>RegisteredUser</h3>
                            <select multiple="multiple" id="groups_RegisteredUser"
                                name="groups_RegisteredUser"
                                data-ng-click="setUserProfile()">
                                <option data-ng-repeat="g in groups" value="{{g.id}}"
                                    data-ng-selected="isUserGroup(g.id, 'RegisteredUser')">{{g.label[lang]}}</option>
                            </select>
                            <h3 data-translate>Editor</h3>
                            <select multiple="multiple" id="groups_Editor"
                                name="groups_EditorUser"
                                data-ng-click="setUserProfile()">
                                <option data-ng-repeat="g in groups" value="{{g.id}}"
                                    data-ng-selected="isUserGroup(g.id, 'Editor')">{{g.label[lang]}}</option>
                            </select>
                            <h3 data-translate>Reviewer</h3>
                            <select multiple="multiple" id="groups_Reviewer"
                                name="groups_Reviewer"
                                data-ng-click="setUserProfile()">
                                <option data-ng-repeat="g in groups" value="{{g.id}}"
                                    data-ng-selected="isUserGroup(g.id, 'Reviewer')">{{g.label[lang]}}</option>
                            </select>
                            <h3 data-translate>UserAdmin</h3>
                            <select multiple="multiple" id="groups_UserAdmin"
                                name="groups_UserAdmin"
                                data-ng-click="setUserProfile()">
                                <option data-ng-repeat="g in groups" value="{{g.id}}"
                                    data-ng-selected="isUserGroup(g.id, 'UserAdmin')">{{g.label[lang]}}</option>
                            </select>
                        </div>
                    </fieldset>
                </fieldset>
            </form>
            
            
            
            <div data-ng-hide="!userRecords">
                <h3>{{userRecords.length}} <span data-translate>userRecords</span> 
                    {{userSelected.name}} {{userSelected.surname}}</h3>
                <ul>
                    <li data-ng-repeat="md in userRecords">{{md.title}}</li>
                </ul>
            </div>
        </div>
    </div>
</div>